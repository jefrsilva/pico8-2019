pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
obj = {dead=false}

function obj:new(o)
	if o == nil then
	 o = {}
	end
	
	setmetatable(o, self)
	self.__index = self
	
	return o
end

jelly = obj:new({
	x = 64,
	y = 64,
	vx = 0,
	vy = 0,
	prop = 5,
	spr = 2, 
	dir = 0
})

function jelly:update()
	self.dir = 0
	if btn(âž¡ï¸) then
	 self.dir = 1
	end
	if btn(â¬…ï¸) then
		self.dir = -1
	end
	self.spr=2
	if btn(ðŸ…¾ï¸) then
		self.spr=18
	 if self.prop >= 0.5 then
	  add(actors,bubble:new({x=self.x,y=self.y+4,vx=rnd(-0.01,0.01)-self.dir*0.5,vy=rnd(1,2),lt=rnd(120,240)}))
 	 self.prop -= 0.5
 	 self.vy -= 0.375
 		self.vx += self.dir * 0.25
		end
	else
 	self.prop=clamp(self.prop+0.05,0,3)	
	end
	self.vx=clamp(self.vx+self.dir*0.04,-1,1)
	self.vy=clamp(self.vy+0.02,-1,1)
	self.x+=self.vx
	self.y+=self.vy
end

function jelly:draw()
 spr(self.spr+self.dir,self.x-4,self.y-4)
end

bubble = obj:new({
 x=0,
 y=0,
	vx=0,
	vy=0,
 lt=0
})

function bubble:update()
 self.vx=clamp(self.vx*0.8,-2,2)
	self.vy=clamp(self.vy-0.1,-1,2)
	self.x+=self.vx
	self.y+=self.vy
	self.lt-=1
	if self.lt <= 0 then
	 self.dead=true
	end
end

function bubble:draw()
 if frame%2==0 then
  circ(self.x,self.y,1,12)
 end
end

function clamp(val, min, max)
 if val < min then
 	return min
 elseif val > max then
  return max
 end
 return val
end

function draw_depth()
	nm=-flr(-depth/32)*32
	nt=nm-depth
	nt=nt+64
	nd=nm+64
	for i=64+nt,-16,-32 do
	 w=2
	 if nd/32%5==0 then
  	print(nd/32,0,i-8,13)
  	w=8
	 end
  line(0,i,w,i,13)	
  line(128-w,i,128,i,13)	
 	nd-=32
	end
end

function _init()
 frame=0
 depth=32000
 actors = {}
 add(actors, jelly:new())
end

function _update()
 for actor in all(actors) do
  actor:update()
  if actor.dead then
   del(actors,actor)
  end
 end
 frame+=1
 depth-=1
end

function _draw()
 cls()
 draw_depth()
 for actor in all(actors) do
  actor:draw()
 end
end
	
	
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000cc0000cccc0000cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cc00c00c0000c00c00cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c000a0cc0a00a0cc0a000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c0a0000cc000000cc0000a0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c000ccccc0cccc0ccccc000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c0cc0000cc0000cc0000cc0c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c00000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000cccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000ccc0000c0000c0000ccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c00ac000ca00ac000ca00c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a0000c00c0000c00c0000a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000c0000c00c0000c00c0000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000c0cccc0c0cc0c0cccc0c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000cc000c0cc00cc0c000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000c00000c0000c00000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000000000011500115001150211501c15018150141600e170081602a1602716001150031500417004150031500b15002150011500115026150211501f1501d15019150161501215000000000000000000000
